<style>
    /* Hide nested lists inside the Table of Contents by default */
    #TableOfContents ul ul,
    #TableOfContents ul ol,
    #TableOfContents ol ul,
    #TableOfContents ol ol {
        display: none;
    }

    /* Show lists when marked as open */
    #TableOfContents .open {
        display: block;
    }
</style>

<script>
    function initTocHide() {
        // 判断是否存在文章目录
        let toc = document.querySelector(".widget--toc");
        if (!toc) {
            return;
        }
        // 监听滚动
        window.addEventListener('scroll', function() {
            //清除class值
            let openUl = document.querySelectorAll(".open");
            if (openUl.length > 0) {
              openUl.forEach((ul) => {
                ul.classList.remove("open")
              })
            }
            // 获取active-class
            let currentLi = document.querySelector(".active-class");
            if (!currentLi) {
                return
            }
            // 展示子ul
            if (currentLi.children.length > 1) {
                currentLi.children[1].classList.add("open")
            }
            // 展示父ul
            let ul = currentLi.parentElement;
            do {
                ul.classList.add("open");
                ul = ul.parentElement.parentElement
            } while (ul !== undefined && (ul.localName === 'ul' || ul.localName === 'ol'))
        });
    }
    initTocHide()
</script>
<style>
    #backTopBtn {
        display: none;
        position: fixed;
        bottom: 30px;
        z-index: 99;
        cursor: pointer;
        width: 30px;
        height: 30px;
        background-image: url({{ (resources.Get "icons/backTop.svg").Permalink }});
    }
</style>

<script>
    /**
     * 滚动回顶部初始化
     */
    function initScrollTop() {
        let rightSideBar = document.querySelector(".right-sidebar");
        if (!rightSideBar) {
            return;
        }
        // 添加返回顶部按钮到右侧边栏
        let btn = document.createElement("div");
        btn.id = "backTopBtn";
        btn.onclick = backToTop
        rightSideBar.appendChild(btn)
        // 滚动监听
        window.onscroll = function() {
            // 当网页向下滑动 20px 出现"返回顶部" 按钮
            if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
                btn.style.display = "block";
            } else {
                btn.style.display = "none";
            }
        };
    }

    /**
     * 返回顶部
     */
    function backToTop(){
        window.scrollTo({ top: 0, behavior: "smooth" })
    }

    initScrollTop();
</script>
<style>
    .highlight {
        /* 你可以根据需要调整这个高度 */
        max-height: 400px;
        overflow: hidden;
    }

    .code-show {
        max-height: none !important;
    }

    .code-collapse {
        max-height: 400px !important;
        overflow: hidden;
    }

    .code-more-box {
        width: 100%;
        padding-top: 78px;
        background-image: -webkit-gradient(linear, left top, left bottom, from(rgba(255, 255, 255, 0)), to(#fff));
        position: absolute;
        left: 0;
        right: 0;
        bottom: 0;
        z-index: 1;
    }

    .code-less-box {
        display: none;
        position: absolute;
        right: 15px;
        bottom: 15px;
        z-index: 10;
    }

    .code-less-btn {
        display: flex;
        justify-content: center;
        align-items: center;
        width: 36px;
        height: 36px;
        background: #f0f0f5;
        border-radius: 50%;
        cursor: pointer;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
        transition: transform 0.2s ease;
    }

    .code-less-btn:hover {
        transform: scale(1.1);
    }

    .code-less-img {
        cursor: pointer !important;
        width: 24px;
        height: 16px;
    }

    .code-more-btn {
        display: flex;
        justify-content: center;
        align-items: center;
        width: 44px;
        height: 22px;
        background: #f0f0f5;
        border-top-left-radius: 8px;
        border-top-right-radius: 8px;
        cursor: pointer;
        margin: auto;
    }

    .code-more-img {
        cursor: pointer !important;
        width: 36px;
        height: 24px;
    }

</style>

<script>
  function initCodeMoreBox() {
    let codeBlocks = document.querySelectorAll(".highlight");
    if (!codeBlocks) {
      return;
    }

    codeBlocks.forEach(codeBlock => {
      // 校验是否overflow
      if (codeBlock.scrollHeight <= codeBlock.clientHeight) {
        return;
      }

      // 为代码块添加 position: relative
      codeBlock.style.position = 'relative';

      // codeMoreBox
      let codeMoreBox = document.createElement('div');
      codeMoreBox.classList.add('code-more-box');

      // codeMoreBtn
      let codeMoreBtn = document.createElement('span');
      codeMoreBtn.classList.add('code-more-btn');
      let codeMoreImg = document.createElement('img');
      codeMoreImg.classList.add('code-more-img');
      codeMoreImg.src = {{ (resources.Get "icons/codeMore.svg").Permalink }}

      // codeLessBox
      let codeLessBox = document.createElement('div');
      codeLessBox.classList.add('code-less-box');

      // codeLessBtn
      let codeLessBtn = document.createElement('div');
      codeLessBtn.classList.add('code-less-btn');
      let codeLessImg = document.createElement('img');
      codeLessImg.classList.add('code-less-img');
      codeLessImg.src = {{ (resources.Get "icons/codeLess.svg").Permalink }}

      // 点击 codeMore 按钮
      codeMoreBtn.addEventListener('click', () => {
        codeBlock.classList.add('code-show');
        codeMoreBox.style.display = 'none';
        codeLessBox.style.display = 'block';
        window.dispatchEvent(new Event('resize'))
      })

      // 点击 codeLess 按钮
      codeLessBtn.addEventListener('click', () => {
        codeBlock.classList.remove('code-show');
        codeMoreBox.style.display = 'block';
        codeLessBox.style.display = 'none';
        window.dispatchEvent(new Event('resize'))
      })

      // 元素添加
      codeMoreBtn.appendChild(codeMoreImg);
      codeMoreBox.appendChild(codeMoreBtn);
      codeLessBtn.appendChild(codeLessImg);
      codeLessBox.appendChild(codeLessBtn);
      codeBlock.appendChild(codeMoreBox);
      codeBlock.appendChild(codeLessBox);
    })
  }

  initCodeMoreBox();
</script>
